---
phase: 04-visualization-engine
plan: 04
type: execute
wave: 3
depends_on: ["04-03"]
files_modified: [src/routes/diagrams/+page.svelte]
autonomous: false
---

<objective>
Create example diagrams page and verify visualization system.

Purpose: Build a showcase page demonstrating all diagram components and get visual verification that the visualization engine works correctly.
Output: /diagrams route with examples of all diagram types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan outputs:
@.planning/phases/04-visualization-engine/04-01-SUMMARY.md
@.planning/phases/04-visualization-engine/04-02-SUMMARY.md
@.planning/phases/04-visualization-engine/04-03-SUMMARY.md

# Design system:
@src/lib/components/ui/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create diagrams showcase page</name>
  <files>src/routes/diagrams/+page.svelte</files>
  <action>
Create a page demonstrating all visualization components:

```svelte
<script lang="ts">
  import { Container, Grid, Card } from '$lib/components/ui';
  import {
    CausalDiagram,
    DAGDiagram,
    TreatmentEffectDiagram
  } from '$lib/components/diagrams';
  import type { DiagramData } from '$lib/components/diagrams';

  // Example 1: Simple confounding diagram
  const confoundingData: DiagramData = {
    nodes: [
      { id: 'x', label: 'Ice Cream Sales', type: 'treatment', x: 100, y: 200 },
      { id: 'y', label: 'Drowning', type: 'outcome', x: 400, y: 200 },
      { id: 'z', label: 'Temperature', type: 'confounder', x: 250, y: 80 }
    ],
    edges: [
      { id: 'xy', source: 'x', target: 'y', label: 'Spurious?', style: 'dashed' },
      { id: 'zx', source: 'z', target: 'x' },
      { id: 'zy', source: 'z', target: 'y' }
    ]
  };

  // Example 2: RCT diagram
  const rctData: DiagramData = {
    nodes: [
      { id: 'random', label: 'Randomization', type: 'variable', x: 100, y: 150 },
      { id: 'treat', label: 'Treatment', type: 'treatment', x: 250, y: 100 },
      { id: 'control', label: 'Control', type: 'control', x: 250, y: 200 },
      { id: 'outcome', label: 'Outcome', type: 'outcome', x: 400, y: 150 }
    ],
    edges: [
      { id: 'rt', source: 'random', target: 'treat' },
      { id: 'rc', source: 'random', target: 'control' },
      { id: 'to', source: 'treat', target: 'outcome' },
      { id: 'co', source: 'control', target: 'outcome' }
    ]
  };

  // Example 3: DAG for IV
  const ivNodes = [
    { id: 'z', label: 'Instrument (Z)', type: 'variable' as const },
    { id: 'x', label: 'Treatment (X)', type: 'treatment' as const },
    { id: 'y', label: 'Outcome (Y)', type: 'outcome' as const },
    { id: 'u', label: 'Unobserved (U)', type: 'confounder' as const }
  ];

  const ivEdges = [
    { id: 'zx', source: 'z', target: 'x' },
    { id: 'xy', source: 'x', target: 'y' },
    { id: 'ux', source: 'u', target: 'x', style: 'dashed' as const },
    { id: 'uy', source: 'u', target: 'y', style: 'dashed' as const }
  ];
</script>

<svelte:head>
  <title>Diagram Examples | Data Analytics in Marketing</title>
</svelte:head>

<Container size="lg">
  <section class="py-8">
    <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">
      Visualization Engine
    </h1>
    <p class="text-slate-600 dark:text-slate-300 mb-8">
      Interactive diagram components for causal inference education.
    </p>

    <Grid cols={1} gap="lg">
      <!-- Example 1: Confounding -->
      <Card padding="lg">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-4">
          1. Confounding Variable
        </h2>
        <p class="text-slate-600 dark:text-slate-300 mb-4">
          Classic example: Ice cream sales and drowning are correlated, but temperature is the confounder.
        </p>
        <CausalDiagram
          data={confoundingData}
          title="Spurious Correlation Example"
          description="Temperature affects both ice cream sales and drowning rates"
        />
      </Card>

      <!-- Example 2: RCT -->
      <Card padding="lg">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-4">
          2. Randomized Controlled Trial
        </h2>
        <p class="text-slate-600 dark:text-slate-300 mb-4">
          Randomization ensures treatment and control groups are comparable.
        </p>
        <CausalDiagram
          data={rctData}
          title="RCT Design"
          description="Random assignment eliminates selection bias"
        />
      </Card>

      <!-- Example 3: Treatment Effect Preset -->
      <Card padding="lg">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-4">
          3. Treatment Effect with Confounders
        </h2>
        <p class="text-slate-600 dark:text-slate-300 mb-4">
          Using the TreatmentEffectDiagram preset component with customizable confounders.
        </p>
        <TreatmentEffectDiagram
          treatment="Marketing Campaign"
          outcome="Sales"
          confounders={['Season', 'Economic Conditions']}
          title="Marketing Effect Analysis"
          description="Identifying confounders in marketing attribution"
        />
      </Card>

      <!-- Example 4: DAG with Auto-Layout -->
      <Card padding="lg">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-4">
          4. Instrumental Variables DAG
        </h2>
        <p class="text-slate-600 dark:text-slate-300 mb-4">
          Auto-layout DAG showing IV identification strategy. Dashed lines show unobserved confounding.
        </p>
        <DAGDiagram
          nodes={ivNodes}
          edges={ivEdges}
          title="IV Identification"
          description="Instrument Z affects Y only through X"
        />
      </Card>
    </Grid>
  </section>
</Container>
```

Features:
- 4 example diagrams covering key causal concepts
- Uses all diagram components (CausalDiagram, DAGDiagram, TreatmentEffectDiagram)
- Educational descriptions
- Responsive layout with design system components
- Dark mode support
  </action>
  <verify>Page loads at /diagrams with all examples</verify>
  <done>Diagrams showcase page with 4 examples</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete visualization engine with SVG containers, node/edge primitives, and high-level diagram components</what-built>
  <how-to-verify>
    1. Run: npm run dev -- --port 5180
    2. Visit: http://localhost:5180/diagrams
    3. Verify all 4 example diagrams render:
       - Confounding example (ice cream/drowning/temperature)
       - RCT diagram (randomization flow)
       - Treatment effect with confounders (marketing/sales)
       - IV DAG with auto-layout
    4. Check visual elements:
       - Nodes have correct colors (green=treatment, blue=control, red=confounder, purple=outcome)
       - Edges have arrow heads pointing to target
       - Labels are readable
       - Dashed lines for uncertain/unobserved relationships
    5. Test responsiveness:
       - Resize browser - diagrams should scale
    6. Test dark mode:
       - Toggle system preference - diagrams should remain visible
    7. Check for console errors
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` succeeds
- [ ] /diagrams page loads
- [ ] All 4 diagram examples render correctly
- [ ] User approves visualization system
</verification>

<success_criteria>
- All tasks completed
- Diagrams render correctly with semantic colors
- Auto-layout works
- User approved visual quality
- Ready for Phase 5: Animation System
</success_criteria>

<output>
After completion, create `.planning/phases/04-visualization-engine/04-04-SUMMARY.md`
</output>
