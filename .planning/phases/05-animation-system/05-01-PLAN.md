# Plan 05-01: Animation Controller & Timeline Engine

## Objective

Build the core animation infrastructure using GSAP that enables step-by-step animated explanations. Create a reusable AnimationController component that manages timelines, playback controls, and step sequencing.

## Scope

**In scope:**
- AnimationController component with play/pause/step controls
- GSAP timeline wrapper for Svelte
- Step-based timeline segmentation (discrete steps users can navigate)
- Progress indicator showing current step
- Keyboard navigation (arrow keys, space)

**Out of scope:**
- Specific diagram animations (Plan 05-02)
- Scroll-triggered animations (Plan 05-03)
- Text/narration sync (future enhancement)

## Tasks

### Task 1: GSAP Svelte Integration
Create a reusable GSAP context manager for Svelte 5.

**File:** `src/lib/components/animation/gsapContext.ts`

**Implementation:**
- Export `createTimeline()` function that returns GSAP timeline
- Handle cleanup on component destroy
- Support timeline labels for step navigation

### Task 2: AnimationTimeline Component
Core timeline component that wraps GSAP functionality.

**File:** `src/lib/components/animation/AnimationTimeline.svelte`

**Props:**
- `steps: AnimationStep[]` - Array of step definitions
- `autoPlay?: boolean` - Start automatically
- `loop?: boolean` - Loop when complete

**Implementation:**
- Build GSAP timeline from steps array
- Add labels at each step boundary
- Expose timeline controls via context

### Task 3: PlaybackControls Component
UI controls for timeline playback.

**File:** `src/lib/components/animation/PlaybackControls.svelte`

**Features:**
- Play/Pause button
- Step backward/forward buttons
- Progress bar with step markers
- Current step indicator (e.g., "Step 2 of 5")
- Keyboard shortcuts (Space = play/pause, ← → = step)

**Styling:**
- Use existing design system tokens
- Compact control bar design
- Dark mode support

### Task 4: Animation Types & Index
Type definitions and barrel export.

**File:** `src/lib/components/animation/index.ts`

**Types:**
```typescript
interface AnimationStep {
  id: string;
  label: string;
  duration: number;
  animation: (tl: gsap.core.Timeline) => void;
}

interface AnimationState {
  playing: boolean;
  currentStep: number;
  totalSteps: number;
  progress: number;
}
```

### Task 5: Demo Page
Create demonstration page showing animation system.

**File:** `src/routes/animations/+page.svelte`

**Demo content:**
- Simple animated counter (proves GSAP works)
- Multi-step animation with playback controls
- Step descriptions showing current step

## Verification

```bash
npm run dev
npm run build
```

- [ ] Visit /animations page
- [ ] Play button starts animation
- [ ] Pause button stops animation
- [ ] Step forward/backward works
- [ ] Progress bar shows current position
- [ ] Keyboard shortcuts work (Space, arrows)
- [ ] No console errors
- [ ] Build succeeds

## Checkpoint

**CHECKPOINT after Task 5**

Before proceeding to Plan 05-02, verify with user:
- Playback controls feel responsive
- Step navigation is intuitive
- Animation timing is smooth
