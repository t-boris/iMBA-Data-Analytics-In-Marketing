# Plan 05-02: Diagram Animation Primitives

## Objective

Create animation primitives specifically for causal diagrams - node appearance, edge drawing, highlighting, and state transitions. These build on the Phase 4 diagram components and the Phase 5 animation controller.

## Scope

**In scope:**
- Node fade-in/scale animations
- Edge draw animations (line drawing effect)
- Highlight animations (pulse, glow)
- Node/edge state transitions
- Animated causal flow visualization

**Out of scope:**
- Full animated explanations (Plan 05-03)
- Text narration
- Complex path morphing

## Tasks

### Task 1: AnimatedNode Component
Node component with built-in animation capabilities.

**File:** `src/lib/components/animation/AnimatedNode.svelte`

**Props:**
- `node: DiagramNode` - Node data
- `animate?: 'fadeIn' | 'scaleIn' | 'none'` - Entry animation
- `highlight?: boolean` - Pulse highlight state
- `delay?: number` - Animation delay

**Animations:**
- `fadeIn`: Opacity 0 → 1
- `scaleIn`: Scale 0 → 1 with slight overshoot
- `highlight`: Subtle pulse effect on stroke

### Task 2: AnimatedEdge Component
Edge component with draw animation.

**File:** `src/lib/components/animation/AnimatedEdge.svelte`

**Props:**
- `edge: DiagramEdge` - Edge data
- `sourceNode, targetNode: DiagramNode`
- `animate?: 'draw' | 'fadeIn' | 'none'` - Entry animation
- `highlight?: boolean` - Highlight state
- `delay?: number`

**Animations:**
- `draw`: Stroke-dashoffset animation (line appears to draw)
- `fadeIn`: Simple opacity transition
- `highlight`: Stroke color/width pulse

### Task 3: AnimatedCausalDiagram Component
Wrapper that orchestrates node/edge animations.

**File:** `src/lib/components/animation/AnimatedCausalDiagram.svelte`

**Props:**
- `data: DiagramData`
- `sequence?: AnimationSequence` - Order of appearance
- `width, height, title, description` (same as CausalDiagram)

**Default sequence:**
1. Nodes appear in order of definition
2. Edges draw after their source/target nodes visible

### Task 4: Animation Sequence Types
Type definitions for diagram animation sequences.

**Add to:** `src/lib/components/animation/index.ts`

```typescript
interface AnimationSequence {
  steps: SequenceStep[];
}

interface SequenceStep {
  targets: string[]; // node/edge IDs
  animation: 'fadeIn' | 'scaleIn' | 'draw' | 'highlight';
  duration?: number;
  stagger?: number;
}
```

### Task 5: Update Demo Page
Add diagram animation examples.

**Update:** `src/routes/animations/+page.svelte`

**Add examples:**
- Confounding diagram building step-by-step
- Causal flow highlight animation
- Before/after treatment effect visualization

## Verification

```bash
npm run dev
npm run build
```

- [ ] AnimatedNode fades/scales in smoothly
- [ ] AnimatedEdge draws from source to target
- [ ] Highlight effect visible on nodes/edges
- [ ] AnimatedCausalDiagram builds diagram step-by-step
- [ ] Demo page shows all animation types
- [ ] No console errors
- [ ] Build succeeds
