# Plan 05-03: Step-by-Step Explanation Component

## Objective

Create the high-level "animated explanation" component that combines diagrams, text explanations, and animations into cohesive step-by-step learning experiences. This is the "3Blue1Brown style" component referenced in the roadmap.

## Scope

**In scope:**
- StepExplanation component combining visuals + text
- Text annotations that appear with diagram changes
- Step navigation with synchronized text/visual
- Reusable explanation templates

**Out of scope:**
- Scroll-triggered animations (separate pattern)
- Audio narration
- Full Module 1 content (Phase 6)

## Tasks

### Task 1: StepExplanation Component
Main component for step-by-step explanations.

**File:** `src/lib/components/animation/StepExplanation.svelte`

**Props:**
```typescript
{
  title: string;
  steps: ExplanationStep[];
  width?: number;
  height?: number;
}
```

**Layout:**
- Diagram area (top or left)
- Step text area (bottom or right)
- Playback controls
- Step indicator

### Task 2: ExplanationStep Type & Builder
Type definitions and helper for building explanations.

**Add to:** `src/lib/components/animation/index.ts`

```typescript
interface ExplanationStep {
  id: string;
  title: string;
  description: string;  // Markdown-like text
  diagram: DiagramData; // State of diagram at this step
  highlights?: string[]; // IDs to highlight
  annotations?: Annotation[];
}

interface Annotation {
  targetId: string; // node/edge ID
  text: string;
  position: 'top' | 'bottom' | 'left' | 'right';
}
```

### Task 3: DiagramAnnotation Component
Floating annotations that point to diagram elements.

**File:** `src/lib/components/animation/DiagramAnnotation.svelte`

**Features:**
- Position relative to target node/edge
- Arrow/line connecting to target
- Fade in/out with step transitions
- Responsive positioning

### Task 4: Explanation Presets
Pre-built explanation templates for common patterns.

**File:** `src/lib/components/animation/presets/index.ts`

**Presets:**
- `confoundingExplanation` - Explains spurious correlation
- `rctExplanation` - Explains randomized experiment
- `treatmentEffectExplanation` - Basic causal effect

These provide ready-to-use step arrays.

### Task 5: Full Demo Page
Complete demonstration with real educational content.

**Update:** `src/routes/animations/+page.svelte`

**Demo content:**
- Full "What is a Confounder?" explanation
- 4-5 steps with progressive diagram building
- Text explanations synchronized with visuals
- Interactive step navigation

## Verification

```bash
npm run dev
npm run build
```

- [ ] StepExplanation renders with diagram + text
- [ ] Steps transition smoothly
- [ ] Annotations appear near target elements
- [ ] Preset explanations work out of box
- [ ] Demo tells coherent educational story
- [ ] Mobile-responsive layout
- [ ] No console errors
- [ ] Build succeeds

## Checkpoint

**CHECKPOINT after Task 5**

This is the core deliverable of Phase 5. Verify with user:
- Educational flow is clear
- Animation pacing feels right
- Text is readable during transitions
- Overall "3Blue1Brown" feel achieved
