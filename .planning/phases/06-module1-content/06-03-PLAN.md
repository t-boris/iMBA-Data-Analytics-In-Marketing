---
phase: 06-module1-content
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/lib/content/module1/matching-methods.ts
  - src/lib/content/module1/instrumental-variables.ts
  - src/lib/components/animation/presets/index.ts
  - src/lib/content/module1/index.ts
  - src/lib/data/modules.ts
autonomous: true
---

<objective>
Create Lectures 4-5: Matching Methods and Instrumental Variables.

Purpose: Cover the two main observational methods for handling confounding when RCTs aren't possible.

Output: Two complete lectures with animated explanations of PSM/IPW/Synthetic Control and IV/2SLS.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Prior work:
@.planning/phases/06-module1-content/06-01-SUMMARY.md

Source files:
@src/lib/components/animation/index.ts
@src/lib/components/animation/presets/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Matching Methods explanation preset</name>
  <files>src/lib/components/animation/presets/index.ts</files>
  <action>
Add new preset function: createMatchingExplanation()

Steps for animated explanation:
1. Start with treated and control groups (different characteristics)
2. Show the problem: groups aren't comparable
3. Introduce propensity scores - probability of treatment
4. Show matching: find control units similar to treated
5. Result: balanced comparison groups
6. Calculate ATT (Average Treatment effect on Treated)

Use node types: treatment (treated units), control (control units), variable (propensity score).
Show visual "matching" by highlighting paired nodes.
  </action>
  <verify>TypeScript compiles, preset function exports</verify>
  <done>Matching explanation preset created with 6 steps</done>
</task>

<task type="auto">
  <name>Task 2: Create Lecture 4 - Matching Methods</name>
  <files>src/lib/content/module1/matching-methods.ts</files>
  <action>
Create content for "Matching Methods" lecture.

Sections:
1. **When RCTs Aren't Possible** - Text explaining observational data challenges
2. **The Matching Idea** - Use new createMatchingExplanation() preset (animated)
3. **Propensity Score Matching (PSM)** - Detailed explanation with formula reference
4. **Inverse Probability Weighting (IPW)** - Alternative weighting approach diagram
5. **Synthetic Control** - For when you have few treated units, show state-level example
6. **Limitations** - Unobservable confounders, common support assumption

The animated matching explanation is the centerpiece.
Include practical marketing example (comparing customers who received promo vs didn't).
  </action>
  <verify>TypeScript compiles, export is valid</verify>
  <done>Lecture 4 content complete with matching animation</done>
</task>

<task type="auto">
  <name>Task 3: Create IV explanation preset and Lecture 5</name>
  <files>src/lib/components/animation/presets/index.ts, src/lib/content/module1/instrumental-variables.ts</files>
  <action>
Add preset: createIVExplanation()

IV explanation steps:
1. The problem: unobserved confounder U affects both X and Y
2. Introduce instrument Z: affects X but NOT Y directly
3. Show the exclusion restriction visually
4. Two-stage process: Z â†’ X (first stage), then predict Y
5. Result: causal effect of X on Y

Then create Lecture 5 content with sections:
1. **The Endogeneity Problem** - Text on unobserved confounders
2. **What is an Instrument?** - Use createIVExplanation() preset (animated)
3. **Classic Example: Distance to College** - Card's returns to education
4. **Two-Stage Least Squares** - Show the two stages with diagrams
5. **Finding Valid Instruments** - Criteria: relevance, exclusion, independence
6. **Marketing Applications** - Geographic variation, timing shocks
  </action>
  <verify>TypeScript compiles, both exports work</verify>
  <done>IV preset and Lecture 5 content complete</done>
</task>

<task type="auto">
  <name>Task 4: Update exports and module data</name>
  <files>src/lib/content/module1/index.ts, src/lib/data/modules.ts</files>
  <action>
1. Add exports for matching-methods and instrumental-variables to index.ts
2. Update lectures 1-4 and 1-5 status to 'ready' in modules.ts
3. Export new presets from animation presets index
  </action>
  <verify>All imports work, 5 lectures now ready</verify>
  <done>Lectures 4-5 ready, new presets exported</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] /module/causal-analysis/matching-methods loads
- [ ] /module/causal-analysis/instrumental-variables loads
- [ ] Matching animation plays correctly
- [ ] IV animation plays correctly
- [ ] Navigation through all 5 lectures works
</verification>

<success_criteria>
- Matching methods lecture complete with PSM/IPW/Synthetic Control
- IV lecture complete with 2SLS explanation
- Two new animation presets (matching, IV) created
- Both lectures marked as ready
</success_criteria>

<output>
After completion, create `.planning/phases/06-module1-content/06-03-SUMMARY.md`
</output>
